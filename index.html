<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financeiro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        body { margin: 0; }
        
        /* Dark Mode */
        .dark { background: #000; color: #fff; }
        .dark .card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); }
        .dark .card:hover { background: rgba(255, 255, 255, 0.08); }
        .dark .input, .dark .user-select { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; }
        .dark .input:focus, .dark .user-select:focus { background: rgba(255, 255, 255, 0.15); border-color: #007AFF; }
        .dark .user-select option { background: #1a1a1a; color: #fff; }
        .dark .sidebar { background: #18181b; border-color: #27272a; }
        .dark .header { background: #18181b; border-color: #27272a; }
        
        /* Light Mode */
        .light { background: #f5f5f7; color: #1d1d1f; }
        .light .card { background: #fff; border: 1px solid #e5e5e7; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .light .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .light .input, .light .user-select { background: #fff; border: 1px solid #d2d2d7; color: #1d1d1f; }
        .light .input:focus, .light .user-select:focus { border-color: #007AFF; }
        .light .user-select option { background: #fff; color: #1d1d1f; }
        .light .sidebar { background: #fff; border-color: #e5e5e7; }
        .light .header { background: #fff; border-color: #e5e5e7; }
        .light .text-white { color: #1d1d1f !important; }
        .light .text-zinc-400 { color: #86868b !important; }
        .light .text-zinc-900 { color: #1d1d1f !important; }
        .light .bg-zinc-900 { background: #fff !important; }
        .light .bg-zinc-800 { background: #f5f5f7 !important; }
        .light .border-zinc-800 { border-color: #e5e5e7 !important; }
        .light .bg-black { background: #f5f5f7 !important; }
        
        /* Common */
        .card { backdrop-filter: blur(20px); transition: all 0.3s; }
        .card:hover { transform: translateY(-2px); }
        .btn { background: #007AFF; transition: all 0.2s; color: #fff; }
        .btn:hover { background: #0051D5; transform: scale(1.02); }
        .input, .user-select { transition: all 0.2s; }
        .user-select { cursor: pointer; font-weight: 500; }
        .user-select:hover { opacity: 0.9; }
        
        /* Dropdown/Select melhorado */
        select { 
            appearance: none; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23fff' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }
        select option { padding: 12px; font-size: 15px; }
        
        /* Modal melhorado - Layout consistente */
        .modal-title { 
            font-size: 1.5rem; 
            font-weight: 600; 
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .modal-field { margin-bottom: 1rem; }
        .modal-field label { 
            display: block; 
            font-size: 0.875rem; 
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .modal-highlight {
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.3);
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
        }
        .modal-highlight-label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.25rem;
        }
        .modal-highlight-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #FF9500;
        }
        .modal-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="color"],
        select,
        .input {
            height: 52px;
            border-radius: 12px;
            font-size: 15px;
        }
        input[type="color"] {
            height: 52px;
            cursor: pointer;
        }
        
        /* Drawer Mobile */
        @media (max-width: 768px) {
            .modal-overlay { align-items: flex-end; }
            .modal-content { 
                max-width: 100% !important; 
                width: 100% !important;
                margin: 0 !important;
                border-radius: 24px 24px 0 0 !important;
                max-height: 85vh;
                animation: slideUp 0.3s ease-out;
            }
        }
        
        @keyframes slideUp {
            from { 
                transform: translateY(100%);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-overlay { animation: fadeIn 0.2s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [tab, setTab] = useState('dashboard');
            const [menu, setMenu] = useState(false);
            const [usuarioAtivo, setUsuarioAtivo] = useState('todos');
            const [darkMode, setDarkMode] = useState(true);
            const [data, setData] = useState({
                users: [
                    { id: 1, nome: 'Voc√™', cor: '#007AFF', tipo: 'pessoa' },
                    { id: 2, nome: 'Esposa', cor: '#FF2D55', tipo: 'pessoa' },
                    { id: 3, nome: 'Minha Empresa', cor: '#10B981', tipo: 'empresa' }
                ],
                salaries: [
                    { id: 1, usuarioId: 1, valor: 5000, descricao: 'Sal√°rio Principal' },
                    { id: 2, usuarioId: 2, valor: 4000, descricao: 'Sal√°rio Esposa' },
                    { id: 3, usuarioId: 3, valor: 15000, descricao: 'Receita Empresa' }
                ],
                exp: [
                    { id: 1, descricao: 'Mercado', valor: 450, usuarioId: 1, data: '2025-09-27', categoria: 'Alimenta√ß√£o', tipoPagamento: 'pix' },
                    { id: 2, descricao: 'Curso', valor: 197, usuarioId: 1, data: '2025-09-14', categoria: 'Educa√ß√£o', tipoPagamento: 'cartao_credito' }
                ],
                subs: [
                    { id: 1, nome: 'Netflix', valor: 55.90, ativa: true },
                    { id: 2, nome: 'Spotify', valor: 21.90, ativa: true }
                ],
                bills: [
                    { id: 1, nome: 'Aluguel', valor: 1200 },
                    { id: 2, nome: 'Luz', valor: 180 },
                    { id: 3, nome: '√Ågua', valor: 80 }
                ],
                cards: [
                    { id: 1, nome: 'Nubank', limite: 5000, gasto: 1200, usuarioId: 1 },
                    { id: 2, nome: 'Inter', limite: 3000, gasto: 450, usuarioId: 2 }
                ],
                goals: [{ id: 1, nome: 'Viagem Disney', valorAlvo: 20000, valorAtual: 5000, cor: '#FF9500' }],
                budgets: [{ id: 1, categoria: 'Mercado', limite: 1000 }, { id: 2, categoria: 'Lazer', limite: 500 }],
                investments: [{ id: 1, nome: 'Tesouro Direto', valor: 23000, tipo: 'Renda Fixa', rendimento: 0.8 }],
                assets: [{ id: 1, nome: 'Apartamento', valor: 395000, tipo: 'Im√≥vel' }],
                debts: [{ id: 1, nome: 'Financiamento Im√≥vel', valorTotal: 280000, valorPago: 80000, parcelas: 360, parcelasPagas: 82 }],
                loans: [{ id: 1, nome: 'Jo√£o', valor: 500, tipo: 'emprestei', data: '2025-09-01', pago: false, parcelado: false, totalParcelas: 1, parcelasPagas: 0, valorParcela: 500 }],
                tools: [
                    { id: 1, ferramenta: 'Claude Code', valor: 120, ativa: true },
                    { id: 2, ferramenta: 'Cursor', valor: 120, ativa: true },
                    { id: 3, ferramenta: 'Lovable', valor: 113, ativa: true },
                    { id: 4, ferramenta: 'Supabase', valor: 25, ativa: true }
                ],
                parcelas: [],
                gasolina: [],
                transferencias: [],
                categoriasCustom: [],
                cartaoTransacoes: [],
                modoCalculo: 'familiar', // 'familiar' ou 'individual'
                tiposPagamento: [
                    { id: 'pix', nome: 'PIX', cor: '#32BCAD' },
                    { id: 'dinheiro', nome: 'Dinheiro', cor: '#4CAF50' },
                    { id: 'cartao_credito', nome: 'Cart√£o Cr√©dito', cor: '#2196F3' },
                    { id: 'cartao_debito', nome: 'Cart√£o D√©bito', cor: '#FF9800' },
                    { id: 'transferencia', nome: 'Transfer√™ncia', cor: '#9C27B0' },
                    { id: 'boleto', nome: 'Boleto', cor: '#FF5722' }
                ]
            });

            const [modal, setModal] = useState(null);
            const [editing, setEditing] = useState(null);
            const [form, setForm] = useState({});

            useEffect(() => {
                const d = localStorage.getItem('finData');
                const theme = localStorage.getItem('darkMode');
                if (d) {
                    try { setData(JSON.parse(d)); } catch (e) { }
                }
                if (theme !== null) {
                    setDarkMode(theme === 'true');
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('finData', JSON.stringify(data));
            }, [data]);

            useEffect(() => {
                localStorage.setItem('darkMode', darkMode.toString());
            }, [darkMode]);

            const fmt = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v);

            const income = data.salaries.reduce((a, s) => a + s.valor, 0);
            const expTotal = data.exp.reduce((a, e) => a + e.valor, 0);
            const subsTotal = data.subs.filter(s => s.ativa).reduce((a, s) => a + s.valor, 0);
            const billsTotal = data.bills.reduce((a, b) => a + b.valor, 0);
            const toolsTotal = data.tools.filter(t => t.ativa).reduce((a, t) => a + t.valor, 0);
            const parcelasTotal = data.parcelas.reduce((a, p) => a + p.valorParcela, 0);
            const gasolinaTotal = data.gasolina.reduce((a, g) => a + g.valor, 0);
            const investTotal = data.investments.reduce((a, i) => a + i.valor, 0);
            const assetsTotal = data.assets.reduce((a, as) => a + as.valor, 0);
            const debtsTotal = data.debts.reduce((a, d) => a + (d.valorTotal - d.valorPago), 0);
            const spent = expTotal + subsTotal + billsTotal + toolsTotal + parcelasTotal + gasolinaTotal;
            const balance = income - spent;
            const netWorth = assetsTotal + investTotal - debtsTotal;
            
            // Filtrar dados por usu√°rio ativo
            const usuariosEmpresa = data.users.filter(u => u.tipo === 'empresa').map(u => u.id);
            const usuariosPessoa = data.users.filter(u => u.tipo === 'pessoa').map(u => u.id);
            
            const gastosUsuario = usuarioAtivo === 'todos' 
                ? data.exp.filter(e => usuariosPessoa.includes(e.usuarioId))
                : usuarioAtivo === 'empresa'
                ? data.exp.filter(e => usuariosEmpresa.includes(e.usuarioId))
                : data.exp.filter(e => e.usuarioId === parseInt(usuarioAtivo));
                
            const salariosUsuario = usuarioAtivo === 'todos'
                ? data.salaries.filter(s => usuariosPessoa.includes(s.usuarioId))
                : usuarioAtivo === 'empresa'
                ? data.salaries.filter(s => usuariosEmpresa.includes(s.usuarioId))
                : data.salaries.filter(s => s.usuarioId === parseInt(usuarioAtivo));
                
            const cartoesUsuario = usuarioAtivo === 'todos' 
                ? data.cards.filter(c => usuariosPessoa.includes(c.usuarioId))
                : usuarioAtivo === 'empresa'
                ? data.cards.filter(c => usuariosEmpresa.includes(c.usuarioId))
                : data.cards.filter(c => c.usuarioId === parseInt(usuarioAtivo));
            
            const incomeUsuario = salariosUsuario.reduce((a, s) => a + s.valor, 0);
            const gastosUsuarioTotal = gastosUsuario.reduce((a, e) => a + e.valor, 0);
            const saldoUsuario = incomeUsuario - (gastosUsuarioTotal + (usuarioAtivo === 'todos' ? subsTotal + billsTotal + toolsTotal : 0));

            const open = (type, item) => { 
                setModal(type); 
                setEditing(item); 
                if (item) {
                    setForm(item);
                } else {
                    // Auto-preencher usuarioId quando criar novo gasto/cart√£o
                    const defaultUserId = usuarioAtivo !== 'todos' ? parseInt(usuarioAtivo) : data.users[0]?.id || 1;
                    setForm(type === 'exp' || type === 'card' ? { usuarioId: defaultUserId } : {});
                }
            };
            const close = () => { setModal(null); setEditing(null); setForm({}); };

            const save = () => {
                if (!form.nome && !form.descricao && !form.ferramenta && !form.categoria && !form.produto && !form.veiculo && !form.de && !form.nomeCategoria) return alert('Preencha os campos');
                const id = editing?.id || Date.now();
                const item = { id, ...form };
                const keyMap = { exp: 'exp', sub: 'subs', bill: 'bills', card: 'cards', goal: 'goals', budget: 'budgets', invest: 'investments', asset: 'assets', debt: 'debts', loan: 'loans', tool: 'tools', user: 'users', salary: 'salaries', parcela: 'parcelas', gasolina: 'gasolina', transferencia: 'transferencias', categoriaCustom: 'categoriasCustom' };
                const key = keyMap[modal];
                const list = data[key];
                setData({ ...data, [key]: editing ? list.map(i => i.id === id ? item : i) : [...list, item] });
                close();
            };

            const del = (key, id) => {
                if (confirm('Excluir?')) setData({ ...data, [key]: data[key].filter(i => i.id !== id) });
            };

            const menus = ['dashboard', 'gastos', 'parcelas', 'gasolina', 'assinaturas', 'contas', 'cartoes', 'faturas', 'metas', 'orcamentos', 'ia', 'investimentos', 'patrimonio', 'dividas', 'emprestimos', 'transferencias', 'usuarios', 'configuracoes'];

            return (
                <div className={`min-h-screen ${darkMode ? 'dark' : 'light'}`}>
                    <div className="flex h-screen">
                        <aside className={`hidden lg:flex flex-col w-64 sidebar border-r ${darkMode ? 'bg-zinc-900 border-zinc-800' : 'bg-white border-gray-200'}`}>
                            <div className="p-6 border-b border-zinc-800">
                                <h1 className="text-2xl font-bold">Financeiro</h1>
                            </div>
                            <nav className="flex-1 overflow-y-auto p-4 space-y-2">
                                {menus.map(t => (
                                    <button
                                        key={t}
                                        onClick={() => setTab(t)}
                                        className={`w-full text-left px-4 py-3 rounded-xl font-medium transition ${
                                            tab === t 
                                                ? 'bg-blue-600 text-white' 
                                                : darkMode 
                                                    ? 'text-zinc-400 hover:bg-zinc-800' 
                                                    : 'text-gray-700 hover:bg-gray-100'
                                        }`}
                                    >
                                        {t === 'ia' ? 'IA/Dev' : t === 'transferencias' ? 'Transfer√™ncias' : t === 'configuracoes' ? 'Configura√ß√µes' : t.charAt(0).toUpperCase() + t.slice(1)}
                                    </button>
                                ))}
                            </nav>
                        </aside>

                        <main className="flex-1 overflow-y-auto">
                            <header className={`header border-b p-4 flex justify-between items-center sticky top-0 z-30 backdrop-blur-xl ${darkMode ? 'bg-zinc-900 border-zinc-800' : 'bg-white border-gray-200'}`}>
                                <h1 className="text-xl font-bold">Financeiro</h1>
                                <div className="flex items-center gap-2 sm:gap-3">
                                    <select 
                                        value={usuarioAtivo} 
                                        onChange={e => setUsuarioAtivo(e.target.value)} 
                                        className="user-select px-3 sm:px-4 py-2 rounded-xl font-medium text-sm"
                                    >
                                        <option value="todos">Fam√≠lia</option>
                                        <option value="empresa">Empresa</option>
                                        {data.users.filter(u => u.tipo === 'pessoa').map(u => <option key={u.id} value={u.id}>{u.nome}</option>)}
                                    </select>
                                    <button 
                                        onClick={() => setDarkMode(!darkMode)} 
                                        className="p-2 rounded-xl hover:bg-zinc-800 transition text-lg"
                                        title={darkMode ? 'Modo Claro' : 'Modo Escuro'}
                                    >
                                        {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                                    </button>
                                    <button onClick={() => setMenu(!menu)} className="p-2 lg:hidden rounded-xl hover:bg-zinc-800">‚ò∞</button>
                                </div>
                            </header>

                            {menu && (
                                <div className="lg:hidden fixed inset-0 z-50 bg-black bg-opacity-90" onClick={() => setMenu(false)}>
                                    <div className={`w-64 h-full p-4 ${darkMode ? 'bg-zinc-900' : 'bg-white'}`} onClick={e => e.stopPropagation()}>
                                        <nav className="space-y-2">
                                            {menus.map(t => (
                                                <button
                                                    key={t}
                                                    onClick={() => { setTab(t); setMenu(false); }}
                                                    className={`w-full text-left px-4 py-3 rounded-xl font-medium transition ${
                                                        tab === t 
                                                            ? 'bg-blue-600 text-white' 
                                                            : darkMode 
                                                                ? 'text-zinc-400 hover:bg-zinc-800' 
                                                                : 'text-gray-700 hover:bg-gray-100'
                                                    }`}
                                                >
                                                    {t === 'ia' ? 'IA/Dev' : t === 'transferencias' ? 'Transfer√™ncias' : t === 'configuracoes' ? 'Configura√ß√µes' : t === 'faturas' ? 'Faturas' : t.charAt(0).toUpperCase() + t.slice(1)}
                                                </button>
                                            ))}
                                        </nav>
                                    </div>
                                </div>
                            )}

                            <div className="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
                                {tab === 'dashboard' && (
                                    <div className="space-y-6">
                                        {usuarioAtivo !== 'todos' && (
                                            <div className="card rounded-2xl p-4 sm:p-6">
                                                <div className="flex items-center gap-4">
                                                    <div className="w-12 h-12 sm:w-16 sm:h-16 rounded-full" style={{ backgroundColor: data.users.find(u => u.id === parseInt(usuarioAtivo))?.cor }} />
                                                    <div>
                                                        <h2 className="text-xl sm:text-2xl font-bold">{data.users.find(u => u.id === parseInt(usuarioAtivo))?.nome}</h2>
                                                        <p className="text-sm text-zinc-400">Visualiza√ß√£o individual</p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        
                                        {/* Cards principais */}
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                            <div className="bg-gradient-to-br from-green-600 to-green-700 p-5 sm:p-6 rounded-3xl">
                                                <h3 className="text-xs sm:text-sm mb-1 font-medium opacity-90">Receitas</h3>
                                                <p className="text-3xl sm:text-4xl font-bold mb-2">{fmt(usuarioAtivo === 'todos' ? income : incomeUsuario)}</p>
                                                <p className="text-xs opacity-75">Total do m√™s</p>
                                            </div>
                                            <div className="bg-gradient-to-br from-red-600 to-red-700 p-5 sm:p-6 rounded-3xl">
                                                <h3 className="text-xs sm:text-sm mb-1 font-medium opacity-90">Despesas</h3>
                                                <p className="text-3xl sm:text-4xl font-bold mb-2">{fmt(usuarioAtivo === 'todos' ? spent : gastosUsuarioTotal)}</p>
                                                <p className="text-xs opacity-75">{((spent/income)*100).toFixed(1)}% da receita</p>
                                            </div>
                                            <div className="bg-gradient-to-br from-blue-600 to-blue-700 p-5 sm:p-6 rounded-3xl sm:col-span-2 lg:col-span-1">
                                                <h3 className="text-xs sm:text-sm mb-1 font-medium opacity-90">Saldo Dispon√≠vel</h3>
                                                <p className="text-3xl sm:text-4xl font-bold mb-2">{fmt(usuarioAtivo === 'todos' ? balance : saldoUsuario)}</p>
                                                <p className="text-xs opacity-75">{balance > 0 ? 'Positivo' : 'Aten√ß√£o!'}</p>
                                            </div>
                                        </div>

                                        {/* Gr√°fico de Despesas por Categoria */}
                                        <div className="card rounded-3xl p-5 sm:p-8">
                                            <h3 className="text-xl sm:text-2xl font-semibold mb-6">Gastos por Categoria</h3>
                                            <div className="space-y-4">
                                                {(() => {
                                                    const categorias = {};
                                                    gastosUsuario.forEach(g => {
                                                        const cat = g.categoria || 'Outros';
                                                        categorias[cat] = (categorias[cat] || 0) + g.valor;
                                                    });
                                                    const cores = {
                                                        'Alimenta√ß√£o': '#FF6B6B',
                                                        'Transporte': '#4ECDC4',
                                                        'Sa√∫de': '#45B7D1',
                                                        'Educa√ß√£o': '#96CEB4',
                                                        'Lazer': '#FFEAA7',
                                                        'Vestu√°rio': '#DFE6E9',
                                                        'Moradia': '#74B9FF',
                                                        'Outros': '#A29BFE'
                                                    };
                                                    return Object.entries(categorias).sort((a, b) => b[1] - a[1]).slice(0, 6).map(([cat, val]) => {
                                                        const perc = (val / gastosUsuario.reduce((a, e) => a + e.valor, 0)) * 100;
                                                        return (
                                                            <div key={cat}>
                                                                <div className="flex justify-between mb-2">
                                                                    <span className="text-sm font-medium">{cat}</span>
                                                                    <span className="text-sm font-bold">{fmt(val)}</span>
                                                                </div>
                                                                <div className="w-full h-2 bg-zinc-800 rounded-full overflow-hidden">
                                                                    <div 
                                                                        className="h-full rounded-full transition-all duration-500"
                                                                        style={{ width: `${perc}%`, backgroundColor: cores[cat] || '#A29BFE' }}
                                                                    />
                                                                </div>
                                                                <p className="text-xs text-zinc-400 mt-1">{perc.toFixed(1)}% do total</p>
                                                            </div>
                                                        );
                                                    });
                                                })()}
                                            </div>
                                        </div>

                                        {/* Compras Parceladas Ativas */}
                                        {data.parcelas.filter(p => p.parcelasPagas < p.totalParcelas).length > 0 && (
                                            <div className="card rounded-3xl p-5 sm:p-8">
                                                <div className="flex justify-between items-center mb-6">
                                                    <h3 className="text-xl sm:text-2xl font-semibold">Parcelas Ativas</h3>
                                                    <span className="text-sm text-zinc-400">{data.parcelas.filter(p => p.parcelasPagas < p.totalParcelas).length} compras</span>
                                                </div>
                                                <div className="space-y-4">
                                                    {data.parcelas.filter(p => p.parcelasPagas < p.totalParcelas).slice(0, 4).map(p => {
                                                        const progresso = (p.parcelasPagas / p.totalParcelas) * 100;
                                                        return (
                                                            <div key={p.id} className="flex items-center gap-4">
                                                                <div className="flex-1">
                                                                    <div className="flex justify-between mb-1">
                                                                        <span className="text-sm font-medium">{p.produto}</span>
                                                                        <span className="text-sm font-bold text-orange-500">{fmt(p.valorParcela)}/m√™s</span>
                                                                    </div>
                                                                    <div className="w-full h-1.5 bg-zinc-800 rounded-full overflow-hidden">
                                                                        <div className="h-full bg-gradient-to-r from-orange-500 to-orange-600 rounded-full" style={{ width: `${progresso}%` }} />
                                                                    </div>
                                                                    <p className="text-xs text-zinc-400 mt-1">{p.parcelasPagas}/{p.totalParcelas} pagas</p>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                                {data.parcelas.filter(p => p.parcelasPagas < p.totalParcelas).length > 4 && (
                                                    <button onClick={() => setTab('parcelas')} className="w-full mt-4 py-2 text-sm text-blue-400 hover:text-blue-300 transition">
                                                        Ver todas as {data.parcelas.filter(p => p.parcelasPagas < p.totalParcelas).length} parcelas ‚Üí
                                                    </button>
                                                )}
                                            </div>
                                        )}

                                        {/* Resumo do M√™s - Grid */}
                                        <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                            <div className="card rounded-2xl p-4">
                                                <p className="text-xs text-zinc-400 mb-1">Gastos Vari√°veis</p>
                                                <p className="text-xl sm:text-2xl font-bold">{fmt(expTotal)}</p>
                                            </div>
                                            <div className="card rounded-2xl p-4">
                                                <p className="text-xs text-zinc-400 mb-1">Parcelas</p>
                                                <p className="text-xl sm:text-2xl font-bold text-orange-500">{fmt(parcelasTotal)}</p>
                                            </div>
                                            <div className="card rounded-2xl p-4">
                                                <p className="text-xs text-zinc-400 mb-1">Gasolina</p>
                                                <p className="text-xl sm:text-2xl font-bold text-yellow-500">{fmt(gasolinaTotal)}</p>
                                            </div>
                                            <div className="card rounded-2xl p-4">
                                                <p className="text-xs text-zinc-400 mb-1">Assinaturas</p>
                                                <p className="text-xl sm:text-2xl font-bold text-blue-500">{fmt(subsTotal)}</p>
                                            </div>
                                            <div className="card rounded-2xl p-4">
                                                <p className="text-xs text-zinc-400 mb-1">Contas Fixas</p>
                                                <p className="text-xl sm:text-2xl font-bold text-purple-500">{fmt(billsTotal)}</p>
                                            </div>
                                            <div className="card rounded-2xl p-4">
                                                <p className="text-xs text-zinc-400 mb-1">IA/Dev</p>
                                                <p className="text-xl sm:text-2xl font-bold text-indigo-500">{fmt(toolsTotal)}</p>
                                            </div>
                                        </div>

                                        {/* Insights */}
                                        <div className="card rounded-3xl p-5 sm:p-8">
                                            <h3 className="text-xl sm:text-2xl font-semibold mb-4">Insights Financeiros</h3>
                                            <div className="space-y-3">
                                                {balance > 0 && <div className="flex items-start gap-3 p-3 bg-green-500 bg-opacity-10 rounded-xl border border-green-500 border-opacity-30">
                                                    <span className="text-2xl">‚úì</span>
                                                    <div>
                                                        <p className="font-semibold text-sm">Saldo positivo!</p>
                                                        <p className="text-xs text-zinc-400">Voc√™ economizou {fmt(balance)} este m√™s</p>
                                                    </div>
                                                </div>}
                                                {balance < 0 && <div className="flex items-start gap-3 p-3 bg-red-500 bg-opacity-10 rounded-xl border border-red-500 border-opacity-30">
                                                    <span className="text-2xl">‚ö†</span>
                                                    <div>
                                                        <p className="font-semibold text-sm">Aten√ß√£o aos gastos!</p>
                                                        <p className="text-xs text-zinc-400">Voc√™ gastou {fmt(Math.abs(balance))} a mais que a receita</p>
                                                    </div>
                                                </div>}
                                                {parcelasTotal > income * 0.3 && <div className="flex items-start gap-3 p-3 bg-orange-500 bg-opacity-10 rounded-xl border border-orange-500 border-opacity-30">
                                                    <span className="text-2xl">üí≥</span>
                                                    <div>
                                                        <p className="font-semibold text-sm">Muitas parcelas ativas</p>
                                                        <p className="text-xs text-zinc-400">Parcelas representam {((parcelasTotal/income)*100).toFixed(0)}% da sua receita</p>
                                                    </div>
                                                </div>}
                                                {data.goals.length > 0 && <div className="flex items-start gap-3 p-3 bg-blue-500 bg-opacity-10 rounded-xl border border-blue-500 border-opacity-30">
                                                    <span className="text-2xl">üéØ</span>
                                                    <div>
                                                        <p className="font-semibold text-sm">Continue economizando!</p>
                                                        <p className="text-xs text-zinc-400">Voc√™ tem {data.goals.length} meta(s) ativa(s)</p>
                                                    </div>
                                                </div>}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {tab === 'gastos' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Gastos {usuarioAtivo !== 'todos' && `- ${data.users.find(u => u.id === parseInt(usuarioAtivo))?.nome}`}</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total: <span className="text-white font-semibold">{fmt(gastosUsuario.reduce((a, e) => a + e.valor, 0))}</span></p>
                                        </div>
                                        <button onClick={() => open('exp')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar Gasto</button>
                                        <div className="space-y-4">
                                            {gastosUsuario.length === 0 ? (
                                                <div className="card p-8 rounded-2xl text-center text-zinc-400">
                                                    <p>Nenhum gasto registrado ainda</p>
                                                </div>
                                            ) : gastosUsuario.map(e => (
                                                <div key={e.id} className="card p-4 sm:p-6 rounded-2xl flex flex-col sm:flex-row justify-between gap-4">
                                                    <div className="flex-1">
                                                        <h4 className="font-semibold text-lg sm:text-xl mb-2">{e.descricao}</h4>
                                                        <div className="flex flex-wrap gap-2 mb-2">
                                                            {e.categoria && <span className="text-xs bg-blue-600 px-2 py-1 rounded-full">{e.categoria}</span>}
                                                            {e.tipoPagamento && <span className="text-xs px-2 py-1 rounded-full" style={{ backgroundColor: data.tiposPagamento.find(tp => tp.id === e.tipoPagamento)?.cor || '#666' }}>
                                                                {data.tiposPagamento.find(tp => tp.id === e.tipoPagamento)?.nome}
                                                            </span>}
                                                        </div>
                                                        <p className="text-xs sm:text-sm text-zinc-400">Por: {data.users.find(u => u.id === e.usuarioId)?.nome}{data.users.find(u => u.id === e.usuarioId)?.tipo === 'empresa' ? ' (Empresa)' : ''}</p>
                                                        <p className="text-xs sm:text-sm text-zinc-400">{new Date(e.data).toLocaleDateString('pt-BR')}</p>
                                                    </div>
                                                    <div className="flex justify-between sm:justify-end items-center gap-4">
                                                        <p className="text-2xl sm:text-3xl font-bold text-red-500">{fmt(e.valor)}</p>
                                                        <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                            <button onClick={() => open('exp', e)} className="text-blue-500 text-sm">Editar</button>
                                                            <button onClick={() => del('exp', e.id)} className="text-red-500 text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'parcelas' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Compras Parceladas</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total mensal: <span className="text-white font-semibold">{fmt(parcelasTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('parcela')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar Compra Parcelada</button>
                                        <div className="space-y-4">
                                            {data.parcelas.length === 0 ? (
                                                <div className="card p-8 rounded-2xl text-center text-zinc-400">
                                                    <p>Nenhuma compra parcelada registrada ainda</p>
                                                </div>
                                            ) : data.parcelas.map(p => {
                                                const progresso = (p.parcelasPagas / p.totalParcelas) * 100;
                                                const parcelasConcluida = p.parcelasPagas >= p.totalParcelas;
                                                return (
                                                    <div key={p.id} className={`card p-4 sm:p-6 rounded-2xl ${parcelasConcluida ? 'opacity-60' : ''}`}>
                                                        <div className="flex flex-col sm:flex-row justify-between gap-4 mb-4">
                                                            <div className="flex-1">
                                                                <h4 className="font-semibold text-lg sm:text-xl mb-2">{p.produto}{parcelasConcluida && ' (Pago)'}</h4>
                                                                <div className="flex flex-wrap gap-2 mb-2">
                                                                    {p.categoria && <span className="text-xs bg-purple-600 px-2 py-1 rounded-full">{p.categoria}</span>}
                                                                    {p.tipoPagamento && <span className="text-xs px-2 py-1 rounded-full" style={{ backgroundColor: data.tiposPagamento.find(tp => tp.id === p.tipoPagamento)?.cor || '#666' }}>
                                                                        {data.tiposPagamento.find(tp => tp.id === p.tipoPagamento)?.nome}
                                                                    </span>}
                                                                </div>
                                                                <p className="text-xs sm:text-sm text-zinc-400">Parcela {p.parcelasPagas} de {p.totalParcelas}</p>
                                                                <p className="text-xs sm:text-sm text-zinc-400">Valor total: {fmt(p.valorTotal)}</p>
                                                            </div>
                                                            <div className="flex justify-between sm:justify-end items-center gap-4">
                                                                <div className="text-left sm:text-right">
                                                                    <p className="text-2xl sm:text-3xl font-bold text-orange-500">{fmt(p.valorParcela)}</p>
                                                                    <p className="text-xs sm:text-sm text-zinc-400">por m√™s</p>
                                                                </div>
                                                                <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                                    {!parcelasConcluida && (
                                                                        <button 
                                                                            onClick={() => {
                                                                                const novaParcela = { ...p, parcelasPagas: p.parcelasPagas + 1 };
                                                                                setData({ ...data, parcelas: data.parcelas.map(i => i.id === p.id ? novaParcela : i) });
                                                                            }}
                                                                            className="text-green-500 text-sm whitespace-nowrap"
                                                                        >
                                                                            Pagar
                                                                        </button>
                                                                    )}
                                                                    <button onClick={() => open('parcela', p)} className="text-blue-500 text-sm">Editar</button>
                                                                    <button onClick={() => del('parcelas', p.id)} className="text-red-500 text-sm">Remover</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="w-full bg-zinc-800 rounded-full h-2 mb-2">
                                                            <div className={`${parcelasConcluida ? 'bg-green-500' : 'bg-orange-500'} rounded-full h-2`} style={{ width: `${progresso}%` }} />
                                                        </div>
                                                        <p className="text-xs sm:text-sm text-zinc-400">
                                                            {parcelasConcluida ? 'Totalmente pago!' : `${progresso.toFixed(1)}% pago ‚Ä¢ Faltam ${p.totalParcelas - p.parcelasPagas} parcelas`}
                                                        </p>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {tab === 'gasolina' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Gasolina</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total mensal: <span className="text-white font-semibold">{fmt(gasolinaTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('gasolina')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar Abastecimento</button>
                                        <div className="space-y-4">
                                            {data.gasolina.length === 0 ? (
                                                <div className="card p-8 rounded-2xl text-center text-zinc-400">
                                                    <p>Nenhum abastecimento registrado ainda</p>
                                                </div>
                                            ) : data.gasolina.map(g => (
                                                <div key={g.id} className="card p-4 sm:p-6 rounded-2xl flex flex-col sm:flex-row justify-between gap-4">
                                                    <div className="flex-1">
                                                        <h4 className="font-semibold text-lg sm:text-xl mb-2">{g.veiculo === 'carro' ? 'Carro' : 'Moto'}</h4>
                                                        <div className="flex flex-wrap gap-2 mb-2">
                                                            {g.tipoPagamento && <span className="text-xs px-2 py-1 rounded-full" style={{ backgroundColor: data.tiposPagamento.find(tp => tp.id === g.tipoPagamento)?.cor || '#666' }}>
                                                                {data.tiposPagamento.find(tp => tp.id === g.tipoPagamento)?.nome}
                                                            </span>}
                                                        </div>
                                                        {g.litros && <p className="text-xs sm:text-sm text-zinc-400">{g.litros} litros ‚Ä¢ {fmt(g.valor / g.litros)}/litro</p>}
                                                        {g.data && <p className="text-xs sm:text-sm text-zinc-400">{new Date(g.data).toLocaleDateString('pt-BR')}</p>}
                                                        {g.local && <p className="text-xs sm:text-sm text-zinc-400">Local: {g.local}</p>}
                                                    </div>
                                                    <div className="flex justify-between sm:justify-end items-center gap-4">
                                                        <p className="text-2xl sm:text-3xl font-bold text-yellow-500">{fmt(g.valor)}</p>
                                                        <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                            <button onClick={() => open('gasolina', g)} className="text-blue-500 text-sm">Editar</button>
                                                            <button onClick={() => del('gasolina', g.id)} className="text-red-500 text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'assinaturas' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Assinaturas</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total: <span className="text-white font-semibold">{fmt(subsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('sub')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.subs.map(s => (
                                                <div key={s.id} className="card p-4 sm:p-6 rounded-2xl flex flex-col sm:flex-row justify-between gap-4">
                                                    <div>
                                                        <h4 className="font-semibold text-lg sm:text-xl mb-2">{s.nome}</h4>
                                                        {s.ativa && <span className="text-xs bg-green-600 px-3 py-1.5 rounded-full">Ativa</span>}
                                                    </div>
                                                    <div className="flex justify-between sm:justify-end items-center gap-4">
                                                        <p className="text-2xl sm:text-3xl font-bold text-blue-500">{fmt(s.valor)}</p>
                                                        <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                            <button onClick={() => open('sub', s)} className="text-blue-500 text-sm">Editar</button>
                                                            <button onClick={() => del('subs', s.id)} className="text-red-500 text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'contas' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Contas Fixas</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total: <span className="text-white font-semibold">{fmt(billsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('bill')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.bills.map(b => (
                                                <div key={b.id} className="card p-4 sm:p-6 rounded-2xl flex flex-col sm:flex-row justify-between gap-4">
                                                    <h4 className="font-semibold text-lg sm:text-xl">{b.nome}</h4>
                                                    <div className="flex justify-between sm:justify-end items-center gap-4">
                                                        <p className="text-2xl sm:text-3xl font-bold text-orange-500">{fmt(b.valor)}</p>
                                                        <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                            <button onClick={() => open('bill', b)} className="text-blue-500 text-sm">Editar</button>
                                                            <button onClick={() => del('bills', b.id)} className="text-red-500 text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'cartoes' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Cart√µes {usuarioAtivo !== 'todos' && `- ${data.users.find(u => u.id === parseInt(usuarioAtivo))?.nome}`}</h2>
                                        </div>
                                        <button onClick={() => open('card')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar Cart√£o</button>
                                        <div className="space-y-4">
                                            {cartoesUsuario.length === 0 ? (
                                                <div className="card p-8 rounded-2xl text-center text-zinc-400">
                                                    <p>Nenhum cart√£o registrado ainda</p>
                                                </div>
                                            ) : cartoesUsuario.map(c => {
                                                const p = (c.gasto / c.limite) * 100;
                                                const u = data.users.find(us => us.id === c.usuarioId);
                                                return (
                                                    <div key={c.id} className="card p-4 sm:p-6 rounded-2xl">
                                                        <div className="flex flex-col sm:flex-row justify-between gap-4 mb-4">
                                                            <div>
                                                                <h4 className="font-semibold text-lg sm:text-xl mb-2">{c.nome}</h4>
                                                                <p className="text-xs sm:text-sm text-zinc-400">Titular: {u?.nome}</p>
                                                            </div>
                                                            <div className="flex justify-between sm:justify-end items-center gap-4">
                                                                <div className="text-left sm:text-right">
                                                                    <p className="text-xl sm:text-2xl font-bold">{fmt(c.gasto)}</p>
                                                                    <p className="text-xs sm:text-sm text-zinc-400">de {fmt(c.limite)}</p>
                                                                </div>
                                                                <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                                    <button onClick={() => open('card', c)} className="text-blue-500 text-sm">Editar</button>
                                                                    <button onClick={() => del('cards', c.id)} className="text-red-500 text-sm">Remover</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="w-full bg-zinc-800 rounded-full h-2">
                                                            <div className={`rounded-full h-2 ${p > 80 ? 'bg-red-500' : p > 50 ? 'bg-yellow-500' : 'bg-green-500'}`} style={{ width: `${p}%` }} />
                                                        </div>
                                                        <p className="text-xs sm:text-sm text-zinc-400 mt-2">{p.toFixed(1)}% utilizado</p>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {tab === 'faturas' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Faturas de Cart√£o</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Controle detalhado das suas faturas</p>
                                        </div>

                                        {cartoesUsuario.length === 0 ? (
                                            <div className="card p-8 rounded-2xl text-center text-zinc-400">
                                                <p>Nenhum cart√£o cadastrado ainda</p>
                                                <button onClick={() => setTab('cartoes')} className="mt-4 text-blue-500">
                                                    Cadastrar cart√£o
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="space-y-6">
                                                {cartoesUsuario.map(cartao => {
                                                    const transacoesCartao = data.cartaoTransacoes.filter(t => t.cartaoId === cartao.id);
                                                    const mesAtual = new Date().getMonth() + 1;
                                                    const anoAtual = new Date().getFullYear();
                                                    const faturaAtual = transacoesCartao.filter(t => t.mesFatura === mesAtual && t.anoFatura === anoAtual);
                                                    const totalFatura = faturaAtual.reduce((a, t) => a + t.valor, 0);
                                                    
                                                    return (
                                                        <div key={cartao.id} className="card rounded-3xl p-5 sm:p-6">
                                                            <div className="flex justify-between items-start mb-4">
                                                                <div>
                                                                    <h3 className="text-xl font-bold mb-1">{cartao.nome}</h3>
                                                                    <p className="text-sm text-zinc-400">
                                                                        Fatura {mesAtual.toString().padStart(2, '0')}/{anoAtual}
                                                                    </p>
                                                                </div>
                                                                <div className="text-right">
                                                                    <p className="text-2xl font-bold text-blue-500">{fmt(totalFatura)}</p>
                                                                    <p className="text-xs text-zinc-400">{faturaAtual.length} transa√ß√µes</p>
                                                                </div>
                                                            </div>

                                                            {faturaAtual.length > 0 ? (
                                                                <div className="space-y-2 mt-4">
                                                                    {faturaAtual.slice(0, 5).map(t => (
                                                                        <div key={t.id} className="flex justify-between items-center p-3 bg-zinc-800 bg-opacity-30 rounded-xl">
                                                                            <div className="flex-1">
                                                                                <p className="text-sm font-medium">{t.descricao}</p>
                                                                                <p className="text-xs text-zinc-400">
                                                                                    {new Date(t.dataCompra).toLocaleDateString('pt-BR')}
                                                                                    {t.isParcelado && ` ‚Ä¢ ${t.parcelaAtual}/${t.parcelas}x`}
                                                                                </p>
                                                                            </div>
                                                                            <p className="text-sm font-bold">{fmt(t.valor)}</p>
                                                                        </div>
                                                                    ))}
                                                                    
                                                                    {faturaAtual.length > 5 && (
                                                                        <p className="text-xs text-center text-zinc-400 pt-2">
                                                                            + {faturaAtual.length - 5} transa√ß√µes
                                                                        </p>
                                                                    )}
                                                                    
                                                                    <button 
                                                                        onClick={() => {
                                                                            const todasPagas = faturaAtual.every(t => t.pago);
                                                                            if (!todasPagas) {
                                                                                const novasTransacoes = data.cartaoTransacoes.map(t => 
                                                                                    (t.cartaoId === cartao.id && t.mesFatura === mesAtual && t.anoFatura === anoAtual) 
                                                                                    ? { ...t, pago: true } 
                                                                                    : t
                                                                                );
                                                                                setData({ ...data, cartaoTransacoes: novasTransacoes });
                                                                            }
                                                                        }}
                                                                        className="w-full mt-4 py-3 bg-green-600 hover:bg-green-700 rounded-xl font-semibold transition"
                                                                    >
                                                                        {faturaAtual.every(t => t.pago) ? 'Fatura Paga' : 'Pagar Fatura'}
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <div className="text-center py-6 text-zinc-400 text-sm">
                                                                    Nenhuma transa√ß√£o este m√™s
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {tab === 'metas' && (
                                    <div>
                                        <h2 className="text-3xl font-bold mb-6">Metas</h2>
                                        <button onClick={() => open('goal')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.goals.map(g => {
                                                const p = (g.valorAtual / g.valorAlvo) * 100;
                                                return (
                                                    <div key={g.id} className="card p-6 rounded-2xl">
                                                        <div className="flex justify-between mb-4">
                                                            <h4 className="font-semibold text-xl">{g.nome}</h4>
                                                            <div className="flex flex-col gap-2">
                                                                <button onClick={() => open('goal', g)} className="text-blue-500">Editar</button>
                                                                <button onClick={() => del('goals', g.id)} className="text-red-500">Remover</button>
                                                            </div>
                                                        </div>
                                                        <div className="w-full bg-zinc-800 rounded-full h-3 mb-3">
                                                            <div className="rounded-full h-3" style={{ width: `${p}%`, backgroundColor: g.cor }} />
                                                        </div>
                                                        <div className="flex justify-between text-sm text-zinc-400">
                                                            <span>{fmt(g.valorAtual)}</span>
                                                            <span>{p.toFixed(0)}%</span>
                                                            <span>{fmt(g.valorAlvo)}</span>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {tab === 'orcamentos' && (
                                    <div>
                                        <h2 className="text-3xl font-bold mb-6">Or√ßamentos</h2>
                                        <button onClick={() => open('budget')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.budgets.map(b => (
                                                <div key={b.id} className="card p-6 rounded-2xl flex justify-between">
                                                    <h4 className="font-semibold text-xl">{b.categoria}</h4>
                                                    <div className="flex gap-4">
                                                        <p className="text-3xl font-bold text-blue-500">{fmt(b.limite)}</p>
                                                        <div className="flex flex-col gap-2">
                                                            <button onClick={() => open('budget', b)} className="text-blue-500">Editar</button>
                                                            <button onClick={() => del('budgets', b.id)} className="text-red-500">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'ia' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Ferramentas IA/Dev</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total: <span className="text-white font-semibold">{fmt(toolsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('tool')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar Ferramenta</button>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {data.tools.map(t => (
                                                <div key={t.id} className={`card p-4 sm:p-6 rounded-2xl ${!t.ativa && 'opacity-50'}`}>
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div className="flex-1">
                                                            <h4 className="font-semibold text-base sm:text-lg mb-1">{t.ferramenta}</h4>
                                                            <p className="text-xs text-zinc-400">Mensal</p>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => open('tool', t)} className="text-blue-500 text-xs sm:text-sm">Editar</button>
                                                            <button onClick={() => del('tools', t.id)} className="text-red-500 text-xs sm:text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                    <p className="text-2xl sm:text-3xl font-bold text-purple-500 mb-4">{fmt(t.valor)}</p>
                                                    <button
                                                        onClick={() => setData({ ...data, tools: data.tools.map(tt => tt.id === t.id ? { ...tt, ativa: !tt.ativa } : tt) })}
                                                        className={`text-xs px-4 py-2 rounded-full font-medium ${t.ativa ? 'bg-green-600' : 'bg-zinc-700'}`}
                                                    >
                                                        {t.ativa ? 'Ativa' : 'Inativa'}
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'investimentos' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-3xl font-bold mb-2">Investimentos</h2>
                                            <p className="text-zinc-400">Total: <span className="text-white font-semibold">{fmt(investTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('invest')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.investments.map(i => (
                                                <div key={i.id} className="card p-6 rounded-2xl flex justify-between">
                                                    <div>
                                                        <h4 className="font-semibold text-xl mb-2">{i.nome}</h4>
                                                        <p className="text-sm text-zinc-400">{i.tipo}</p>
                                                        <p className="text-sm text-green-500">Rendimento: {i.rendimento}%</p>
                                                    </div>
                                                    <div className="flex gap-4">
                                                        <p className="text-3xl font-bold text-green-500">{fmt(i.valor)}</p>
                                                        <div className="flex flex-col gap-2">
                                                            <button onClick={() => open('invest', i)} className="text-blue-500">Editar</button>
                                                            <button onClick={() => del('investments', i.id)} className="text-red-500">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'patrimonio' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-3xl font-bold mb-2">Patrim√¥nio</h2>
                                            <p className="text-zinc-400">Total: <span className="text-white font-semibold">{fmt(assetsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('asset')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.assets.map(a => (
                                                <div key={a.id} className="card p-6 rounded-2xl flex justify-between">
                                                    <div>
                                                        <h4 className="font-semibold text-xl mb-2">{a.nome}</h4>
                                                        <p className="text-sm text-zinc-400">{a.tipo}</p>
                                                    </div>
                                                    <div className="flex gap-4">
                                                        <p className="text-3xl font-bold text-blue-500">{fmt(a.valor)}</p>
                                                        <div className="flex flex-col gap-2">
                                                            <button onClick={() => open('asset', a)} className="text-blue-500">Editar</button>
                                                            <button onClick={() => del('assets', a.id)} className="text-red-500">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'dividas' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-3xl font-bold mb-2">D√≠vidas</h2>
                                            <p className="text-zinc-400">Restante: <span className="text-white font-semibold">{fmt(debtsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('debt')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.debts.map(d => {
                                                const p = (d.valorPago / d.valorTotal) * 100;
                                                return (
                                                    <div key={d.id} className="card p-6 rounded-2xl">
                                                        <div className="flex justify-between mb-4">
                                                            <div>
                                                                <h4 className="font-semibold text-xl mb-2">{d.nome}</h4>
                                                                <p className="text-sm text-zinc-400">Parcela {d.parcelasPagas} de {d.parcelas}</p>
                                                            </div>
                                                            <div className="flex gap-4">
                                                                <div className="text-right">
                                                                    <p className="text-2xl font-bold text-red-500">{fmt(d.valorTotal - d.valorPago)}</p>
                                                                    <p className="text-sm text-zinc-400">restante</p>
                                                                </div>
                                                                <div className="flex flex-col gap-2">
                                                                    <button onClick={() => open('debt', d)} className="text-blue-500">Editar</button>
                                                                    <button onClick={() => del('debts', d.id)} className="text-red-500">Remover</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="w-full bg-zinc-800 rounded-full h-2">
                                                            <div className="bg-green-500 rounded-full h-2" style={{ width: `${p}%` }} />
                                                        </div>
                                                        <p className="text-sm text-zinc-400 mt-2">{p.toFixed(1)}% pago</p>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {tab === 'emprestimos' && (
                                    <div>
                                        <h2 className="text-3xl font-bold mb-6">Empr√©stimos</h2>
                                        <button onClick={() => open('loan')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.loans.map(l => {
                                                const progresso = l.parcelado ? (l.parcelasPagas / l.totalParcelas) * 100 : (l.pago ? 100 : 0);
                                                const parcelasConcluida = l.parcelado ? l.parcelasPagas >= l.totalParcelas : l.pago;
                                                return (
                                                    <div key={l.id} className={`card p-6 rounded-2xl ${parcelasConcluida ? 'opacity-60' : ''}`}>
                                                        <div className="flex justify-between mb-4">
                                                            <div>
                                                                <h4 className="font-semibold text-xl mb-2">{l.nome}{parcelasConcluida && ' (Pago)'}</h4>
                                                                <p className="text-sm text-zinc-400">{l.tipo === 'emprestei' ? 'Voc√™ emprestou' : 'Voc√™ pegou'}</p>
                                                                <p className="text-sm text-zinc-400">{new Date(l.data).toLocaleDateString('pt-BR')}</p>
                                                                {l.parcelado && <p className="text-sm text-zinc-400 mt-1">Parcelado: {l.parcelasPagas}/{l.totalParcelas} pagas</p>}
                                                            </div>
                                                            <div className="flex gap-4">
                                                                <div className="text-right">
                                                                    <p className={`text-3xl font-bold ${l.tipo === 'emprestei' ? 'text-green-500' : 'text-red-500'}`}>
                                                                        {l.parcelado ? fmt(l.valorParcela) : fmt(l.valor)}
                                                                    </p>
                                                                    {l.parcelado && <p className="text-sm text-zinc-400">por m√™s</p>}
                                                                    {l.parcelado && <p className="text-xs text-zinc-400 mt-1">Total: {fmt(l.valor)}</p>}
                                                                </div>
                                                                <div className="flex flex-col gap-2">
                                                                    {l.parcelado && !parcelasConcluida && (
                                                                        <button 
                                                                            onClick={() => {
                                                                                const novoLoan = { ...l, parcelasPagas: l.parcelasPagas + 1 };
                                                                                if (novoLoan.parcelasPagas >= novoLoan.totalParcelas) {
                                                                                    novoLoan.pago = true;
                                                                                }
                                                                                setData({ ...data, loans: data.loans.map(i => i.id === l.id ? novoLoan : i) });
                                                                            }}
                                                                            className="text-green-500 text-sm whitespace-nowrap"
                                                                        >
                                                                            Pagar
                                                                        </button>
                                                                    )}
                                                                    {!l.parcelado && !l.pago && (
                                                                        <button 
                                                                            onClick={() => {
                                                                                setData({ ...data, loans: data.loans.map(i => i.id === l.id ? { ...i, pago: true } : i) });
                                                                            }}
                                                                            className="text-green-500 text-sm"
                                                                        >
                                                                            Marcar Pago
                                                                        </button>
                                                                    )}
                                                                    <button onClick={() => open('loan', l)} className="text-blue-500 text-sm">Editar</button>
                                                                    <button onClick={() => del('loans', l.id)} className="text-red-500 text-sm">Remover</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {l.parcelado && (
                                                            <>
                                                                <div className="w-full bg-zinc-800 rounded-full h-2 mb-2">
                                                                    <div className={`${parcelasConcluida ? 'bg-green-500' : l.tipo === 'emprestei' ? 'bg-green-500' : 'bg-red-500'} rounded-full h-2`} style={{ width: `${progresso}%` }} />
                                                                </div>
                                                                <p className="text-sm text-zinc-400">
                                                                    {parcelasConcluida ? 'Totalmente pago!' : `${progresso.toFixed(1)}% pago ‚Ä¢ Faltam ${l.totalParcelas - l.parcelasPagas} parcelas`}
                                                                </p>
                                                            </>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {tab === 'usuarios' && (
                                    <div>
                                        <h2 className="text-3xl font-bold mb-6">Usu√°rios</h2>
                                        <button onClick={() => open('user')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.users.map(u => {
                                                const sal = data.salaries.find(s => s.usuarioId === u.id);
                                                const userExp = data.exp.filter(e => e.usuarioId === u.id).reduce((a, e) => a + e.valor, 0);
                                                return (
                                                    <div key={u.id} className="card p-6 rounded-2xl">
                                                        <div className="flex gap-4 mb-4">
                                                            <div className="w-16 h-16 rounded-full" style={{ backgroundColor: u.cor }} />
                                                            <div className="flex-1">
                                                                <h4 className="font-semibold text-xl mb-2">{u.nome}</h4>
                                                                <button onClick={() => open('salary', sal || { usuarioId: u.id })} className="text-sm text-blue-500">
                                                                    {sal ? 'Editar' : 'Adicionar'} sal√°rio
                                                                </button>
                                                            </div>
                                                            <div className="flex flex-col gap-2">
                                                                <button onClick={() => open('user', u)} className="text-blue-500">Editar</button>
                                                                <button onClick={() => del('users', u.id)} className="text-red-500">Remover</button>
                                                            </div>
                                                        </div>
                                                        <div className="grid grid-cols-2 gap-4">
                                                            <div>
                                                                <p className="text-sm text-zinc-400 mb-1">Sal√°rio</p>
                                                                <p className="font-semibold text-lg text-green-500">{fmt(sal?.valor || 0)}</p>
                                                            </div>
                                                            <div>
                                                                <p className="text-sm text-zinc-400 mb-1">Gastos</p>
                                                                <p className="font-semibold text-lg text-red-500">{fmt(userExp)}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {modal && (
                                    <div className="modal-overlay fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 backdrop-blur-sm" onClick={close}>
                                        <div className="modal-content card rounded-3xl p-6 sm:p-8 max-w-md w-full max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                            <h3 className="modal-title">{editing ? 'Editar' : 'Adicionar'}</h3>
                                            <div className="space-y-3">
                                                {modal === 'exp' && (
                                                    <>
                                                        <div className="modal-field">
                                                            <input type="text" placeholder="Descri√ß√£o" value={form.descricao || ''} onChange={e => setForm({ ...form, descricao: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <select value={form.categoria || ''} onChange={e => setForm({ ...form, categoria: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                                <option value="">Selecione a categoria</option>
                                                                <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                                                                <option value="Transporte">Transporte</option>
                                                                <option value="Sa√∫de">Sa√∫de</option>
                                                                <option value="Educa√ß√£o">Educa√ß√£o</option>
                                                                <option value="Lazer">Lazer</option>
                                                                <option value="Vestu√°rio">Vestu√°rio</option>
                                                                <option value="Moradia">Moradia</option>
                                                                <option value="Outros">Outros</option>
                                                            </select>
                                                        </div>
                                                        <div className="modal-field">
                                                            <select value={form.tipoPagamento || ''} onChange={e => setForm({ ...form, tipoPagamento: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                                <option value="">Tipo de Pagamento</option>
                                                                {data.tiposPagamento.map(tp => <option key={tp.id} value={tp.id}>{tp.nome}</option>)}
                                                            </select>
                                                        </div>
                                                        <div className="modal-field">
                                                            <select value={form.usuarioId || 1} onChange={e => setForm({ ...form, usuarioId: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                                {data.users.map(u => <option key={u.id} value={u.id}>{u.nome} {u.tipo === 'empresa' ? '(Empresa)' : ''}</option>)}
                                                            </select>
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="date" value={form.data || ''} onChange={e => setForm({ ...form, data: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                    </>
                                                )}
                                                {modal === 'sub' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <div className="flex items-center gap-3">
                                                            <input type="checkbox" checked={form.ativa !== false} onChange={e => setForm({ ...form, ativa: e.target.checked })} className="w-5 h-5" />
                                                            <label>Ativa</label>
                                                        </div>
                                                    </>
                                                )}
                                                {modal === 'bill' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'card' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Limite" value={form.limite || ''} onChange={e => setForm({ ...form, limite: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Gasto" value={form.gasto || ''} onChange={e => setForm({ ...form, gasto: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <select value={form.usuarioId || 1} onChange={e => setForm({ ...form, usuarioId: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                            {data.users.map(u => <option key={u.id} value={u.id}>{u.nome}</option>)}
                                                        </select>
                                                    </>
                                                )}
                                                {modal === 'goal' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor Alvo" value={form.valorAlvo || ''} onChange={e => setForm({ ...form, valorAlvo: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor Atual" value={form.valorAtual || ''} onChange={e => setForm({ ...form, valorAtual: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="color" value={form.cor || '#007AFF'} onChange={e => setForm({ ...form, cor: e.target.value })} className="w-full h-12 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'budget' && (
                                                    <>
                                                        <input type="text" placeholder="Categoria" value={form.categoria || ''} onChange={e => setForm({ ...form, categoria: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Limite" value={form.limite || ''} onChange={e => setForm({ ...form, limite: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'invest' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="text" placeholder="Tipo" value={form.tipo || ''} onChange={e => setForm({ ...form, tipo: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Rendimento" value={form.rendimento || ''} onChange={e => setForm({ ...form, rendimento: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'asset' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="text" placeholder="Tipo" value={form.tipo || ''} onChange={e => setForm({ ...form, tipo: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'debt' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor Total" value={form.valorTotal || ''} onChange={e => setForm({ ...form, valorTotal: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor Pago" value={form.valorPago || ''} onChange={e => setForm({ ...form, valorPago: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Parcelas" value={form.parcelas || ''} onChange={e => setForm({ ...form, parcelas: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Parcelas Pagas" value={form.parcelasPagas || ''} onChange={e => setForm({ ...form, parcelasPagas: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'loan' && (
                                                    <>
                                                        <div className="modal-field">
                                                            <input type="text" placeholder="Nome da Pessoa" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <select value={form.tipo || 'emprestei'} onChange={e => setForm({ ...form, tipo: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                                <option value="emprestei">Emprestei</option>
                                                                <option value="peguei">Peguei</option>
                                                            </select>
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="number" placeholder="Valor Total" value={form.valor || ''} onChange={e => {
                                                                const val = parseFloat(e.target.value);
                                                                const parcelas = form.totalParcelas || 1;
                                                                setForm({ ...form, valor: val, valorParcela: val / parcelas });
                                                            }} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <div className="flex items-center gap-3 p-3 bg-zinc-800 rounded-xl">
                                                                <input 
                                                                    type="checkbox" 
                                                                    checked={form.parcelado || false} 
                                                                    onChange={e => {
                                                                        const parcelado = e.target.checked;
                                                                        if (!parcelado) {
                                                                            setForm({ ...form, parcelado, totalParcelas: 1, parcelasPagas: 0, valorParcela: form.valor || 0 });
                                                                        } else {
                                                                            setForm({ ...form, parcelado });
                                                                        }
                                                                    }}
                                                                    className="w-5 h-5" 
                                                                />
                                                                <label className="font-medium">Pagar Parcelado</label>
                                                            </div>
                                                        </div>
                                                        {form.parcelado && (
                                                            <>
                                                                <div className="modal-field">
                                                                    <input 
                                                                        type="number" 
                                                                        placeholder="N√∫mero de Parcelas" 
                                                                        value={form.totalParcelas || ''} 
                                                                        onChange={e => {
                                                                            const parcelas = parseInt(e.target.value);
                                                                            const val = form.valor || 0;
                                                                            setForm({ ...form, totalParcelas: parcelas, valorParcela: val / parcelas });
                                                                        }} 
                                                                        className="w-full input text-white px-4 py-3 rounded-xl" 
                                                                    />
                                                                </div>
                                                                <div className="modal-highlight">
                                                                    <p className="modal-highlight-label">Valor da Parcela</p>
                                                                    <p className="modal-highlight-value">{fmt(form.valorParcela || 0)}</p>
                                                                </div>
                                                                <div className="modal-field">
                                                                    <input 
                                                                        type="number" 
                                                                        placeholder="Parcelas J√° Pagas" 
                                                                        value={form.parcelasPagas || 0} 
                                                                        onChange={e => setForm({ ...form, parcelasPagas: parseInt(e.target.value) })} 
                                                                        className="w-full input text-white px-4 py-3 rounded-xl" 
                                                                    />
                                                                </div>
                                                            </>
                                                        )}
                                                        <div className="modal-field">
                                                            <input type="date" value={form.data || ''} onChange={e => setForm({ ...form, data: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        {!form.parcelado && (
                                                            <div className="modal-field">
                                                                <div className="flex items-center gap-3 p-3 bg-zinc-800 rounded-xl">
                                                                    <input 
                                                                        type="checkbox" 
                                                                        checked={form.pago || false} 
                                                                        onChange={e => setForm({ ...form, pago: e.target.checked })} 
                                                                        className="w-5 h-5" 
                                                                    />
                                                                    <label className="font-medium">J√° foi pago</label>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </>
                                                )}
                                                {modal === 'tool' && (
                                                    <>
                                                        <input type="text" placeholder="Ferramenta" value={form.ferramenta || ''} onChange={e => setForm({ ...form, ferramenta: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <div className="flex items-center gap-3">
                                                            <input type="checkbox" checked={form.ativa !== false} onChange={e => setForm({ ...form, ativa: e.target.checked })} className="w-5 h-5" />
                                                            <label>Ativa</label>
                                                        </div>
                                                    </>
                                                )}
                                                {modal === 'user' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <select value={form.tipo || 'pessoa'} onChange={e => setForm({ ...form, tipo: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                            <option value="pessoa">Pessoa</option>
                                                            <option value="empresa">Empresa</option>
                                                        </select>
                                                        <input type="color" value={form.cor || '#007AFF'} onChange={e => setForm({ ...form, cor: e.target.value })} className="w-full h-12 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'salary' && (
                                                    <>
                                                        <select value={form.usuarioId || 1} onChange={e => setForm({ ...form, usuarioId: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                            {data.users.map(u => <option key={u.id} value={u.id}>{u.nome}</option>)}
                                                        </select>
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="text" placeholder="Descri√ß√£o" value={form.descricao || ''} onChange={e => setForm({ ...form, descricao: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'parcela' && (
                                                    <>
                                                        <div className="modal-field">
                                                            <input type="text" placeholder="Nome do Produto" value={form.produto || ''} onChange={e => setForm({ ...form, produto: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <select value={form.categoria || ''} onChange={e => setForm({ ...form, categoria: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                                <option value="">Selecione a categoria</option>
                                                                <option value="Eletrodom√©sticos">Eletrodom√©sticos</option>
                                                                <option value="Eletr√¥nicos">Eletr√¥nicos</option>
                                                                <option value="M√≥veis">M√≥veis</option>
                                                                <option value="Vestu√°rio">Vestu√°rio</option>
                                                                <option value="Ve√≠culo">Ve√≠culo</option>
                                                                <option value="Reforma">Reforma</option>
                                                                <option value="Outros">Outros</option>
                                                            </select>
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="number" placeholder="Valor Total da Compra" value={form.valorTotal || ''} onChange={e => {
                                                                const vt = parseFloat(e.target.value);
                                                                const tp = form.totalParcelas || 1;
                                                                setForm({ ...form, valorTotal: vt, valorParcela: vt / tp });
                                                            }} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="number" placeholder="N√∫mero de Parcelas" value={form.totalParcelas || ''} onChange={e => {
                                                                const tp = parseInt(e.target.value);
                                                                const vt = form.valorTotal || 0;
                                                                setForm({ ...form, totalParcelas: tp, valorParcela: vt / tp });
                                                            }} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-highlight">
                                                            <p className="modal-highlight-label">Valor da Parcela</p>
                                                            <p className="modal-highlight-value">{fmt(form.valorParcela || 0)}</p>
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="number" placeholder="Parcelas J√° Pagas" value={form.parcelasPagas || ''} onChange={e => setForm({ ...form, parcelasPagas: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <select value={form.tipoPagamento || ''} onChange={e => setForm({ ...form, tipoPagamento: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                                <option value="">Tipo de Pagamento</option>
                                                                {data.tiposPagamento.map(tp => <option key={tp.id} value={tp.id}>{tp.nome}</option>)}
                                                            </select>
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="date" value={form.data || ''} onChange={e => setForm({ ...form, data: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                    </>
                                                )}
                                                {modal === 'gasolina' && (
                                                    <>
                                                        <div className="modal-field">
                                                            <select value={form.veiculo || 'carro'} onChange={e => setForm({ ...form, veiculo: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                                <option value="carro">Carro</option>
                                                                <option value="moto">Moto</option>
                                                            </select>
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="number" placeholder="Valor Pago" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="number" placeholder="Litros (opcional)" value={form.litros || ''} onChange={e => setForm({ ...form, litros: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        {form.valor && form.litros && (
                                                            <div className="modal-highlight">
                                                                <p className="modal-highlight-label">Pre√ßo por Litro</p>
                                                                <p className="modal-highlight-value">{fmt(form.valor / form.litros)}</p>
                                                            </div>
                                                        )}
                                                        <div className="modal-field">
                                                            <select value={form.tipoPagamento || ''} onChange={e => setForm({ ...form, tipoPagamento: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                                <option value="">Tipo de Pagamento</option>
                                                                {data.tiposPagamento.map(tp => <option key={tp.id} value={tp.id}>{tp.nome}</option>)}
                                                            </select>
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="text" placeholder="Local (opcional)" value={form.local || ''} onChange={e => setForm({ ...form, local: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                        <div className="modal-field">
                                                            <input type="date" value={form.data || ''} onChange={e => setForm({ ...form, data: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        </div>
                                                    </>
                                                )}
                                                <div className="modal-buttons">
                                                    <button onClick={save} className="flex-1 btn text-white py-3.5 rounded-xl font-semibold text-base">Salvar</button>
                                                    <button onClick={close} className="flex-1 bg-zinc-700 hover:bg-zinc-600 text-white py-3.5 rounded-xl font-semibold text-base transition">Cancelar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
